/* http://keith-wood.name/realPerson.html Real Person Form Submission for jQuery v2.0.1. Written by Keith Wood (kwood{at}iinet.com.au) June 2009.
   Available under the MIT (http://keith-wood.name/licence.html) license. Please attribute the author if you use it. */

(function($){var pluginName='realperson';var ALPHABETIC='ABCDEFGHIJKLMNOPQRSTUVWXYZ';var ALPHANUMERIC=ALPHABETIC+'0123456789';var DOTS=[['   *   ','  * *  ','  * *  ',' *   * ',' ***** ','*     *','*     *'],['****** ','*     *','*     *','****** ','*     *','*     *','****** '],[' ***** ','*     *','*      ','*      ','*      ','*     *',' ***** '],['****** ','*     *','*     *','*     *','*     *','*     *','****** '],['*******','*      ','*      ','****   ','*      ','*      ','*******'],['*******','*      ','*      ','****   ','*      ','*      ','*      '],[' ***** ','*     *','*      ','*      ','*   ***','*     *',' ***** '],['*     *','*     *','*     *','*******','*     *','*     *','*     *'],['*******','   *   ','   *   ','   *   ','   *   ','   *   ','*******'],['      *','      *','      *','      *','      *','*     *',' ***** '],['*     *','*   ** ','* **   ','**     ','* **   ','*   ** ','*     *'],['*      ','*      ','*      ','*      ','*      ','*      ','*******'],['*     *','**   **','* * * *','*  *  *','*     *','*     *','*     *'],['*     *','**    *','* *   *','*  *  *','*   * *','*    **','*     *'],[' ***** ','*     *','*     *','*     *','*     *','*     *',' ***** '],['****** ','*     *','*     *','****** ','*      ','*      ','*      '],[' ***** ','*     *','*     *','*     *','*   * *','*    * ',' **** *'],['****** ','*     *','*     *','****** ','*   *  ','*    * ','*     *'],[' ***** ','*     *','*      ',' ***** ','      *','*     *',' ***** '],['*******','   *   ','   *   ','   *   ','   *   ','   *   ','   *   '],['*     *','*     *','*     *','*     *','*     *','*     *',' ***** '],['*     *','*     *',' *   * ',' *   * ','  * *  ','  * *  ','   *   '],['*     *','*     *','*     *','*  *  *','* * * *','**   **','*     *'],['*     *',' *   * ','  * *  ','   *   ','  * *  ',' *   * ','*     *'],['*     *',' *   * ','  * *  ','   *   ','   *   ','   *   ','   *   '],['*******','     * ','    *  ','   *   ','  *    ',' *     ','*******'],['  ***  ',' *   * ','*   * *','*  *  *','* *   *',' *   * ','  ***  '],['   *   ','  **   ',' * *   ','   *   ','   *   ','   *   ','*******'],[' ***** ','*     *','      *','     * ','   **  ',' **    ','*******'],[' ***** ','*     *','      *','    ** ','      *','*     *',' ***** '],['    *  ','   **  ','  * *  ',' *  *  ','*******','    *  ','    *  '],['*******','*      ','****** ','      *','      *','*     *',' ***** '],['  **** ',' *     ','*      ','****** ','*     *','*     *',' ***** '],['*******','     * ','    *  ','   *   ','  *    ',' *     ','*      '],[' ***** ','*     *','*     *',' ***** ','*     *','*     *',' ***** '],[' ***** ','*     *','*     *',' ******','      *','     * ',' ****  ']];$.JQPlugin.createPlugin({name:pluginName,alphabetic:ALPHABETIC,alphanumeric:ALPHANUMERIC,defaultDots:DOTS,defaultOptions:{length:6,regenerate:'Click to change',hashName:'{n}Hash',dot:'*',dots:DOTS,chars:ALPHABETIC},_getters:['getHash'],_challengeClass:pluginName+'-challenge',_disabledClass:pluginName+'-disabled',_hashClass:pluginName+'-hash',_regenerateClass:pluginName+'-regen',_textClass:pluginName+'-text',_optionsChanged:function(elem,inst,options){$.extend(inst.options,options);var text='';for(var i=0;i<inst.options.length;i++){text+=inst.options.chars.charAt(Math.floor(Math.random()*inst.options.chars.length))}
inst.hash=hash(text+salt);var self=this;elem.closest('form').off('.'+inst.name).on('submit.'+inst.name,function(){var name=inst.options.hashName.replace(/\{n\}/,elem.attr('name'));var form=$(this);form.find('input[name="'+name+'"]').remove();form.append('<input type="hidden" class="'+self._hashClass+'" name="'+name+'" value="'+hash(text+salt)+'">');setTimeout(function(){form.find('input[name="'+name+'"]').remove()},0)});elem.nextAll('.'+this._challengeClass+',.'+this._hashClass).remove().end().after(this._generateHTML(inst,text)).nextAll('div.'+this._challengeClass).click(function(){if(!$(this).hasClass(self._disabledClass)){elem.realperson('option',{})}})},enable:function(elem){elem=$(elem);if(!elem.hasClass(this._getMarker())){return}
elem.removeClass(this._disabledClass).prop('disabled',!1).prevAll('.'+this._challengeClass).removeClass(this._disabledClass)},disable:function(elem){elem=$(elem);if(!elem.hasClass(this._getMarker())){return}
elem.addClass(this._disabledClass).prop('disabled',!0).prevAll('.'+this._challengeClass).addClass(this._disabledClass)},getHash:function(elem){var inst=this._getInst(elem);return inst?inst.hash:0},_generateHTML:function(inst,text){var html='<div class="'+this._challengeClass+'">'+'<div class="'+this._textClass+'">';for(var i=0;i<inst.options.dots[0].length;i++){for(var j=0;j<text.length;j++){html+=inst.options.dots[inst.options.chars.indexOf(text.charAt(j))][i].replace(/ /g,'&#160;').replace(/\*/g,inst.options.dot)+'&#160;&#160;'}
html+='<br>'}
html+='</div><div class="'+this._regenerateClass+'"><i class="fa fa-refresh"></i>'+inst.options.regenerate+'</div></div>';return html},_preDestroy:function(elem,inst){elem.closest('form').off('.'+inst.name);elem.prevAll('.'+this._challengeClass+',.'+this._hashClass).remove()}});var salt=$.salt||'#salt';delete $.salt;$(function(){var saltElem=$(salt);if(saltElem.length){salt=saltElem.text();saltElem.remove()}
if(salt==='#salt'){salt=''}});function hash(value){var hash=5381;$('#defaultReal').attr('captchav',CryptoJS.AES.encrypt(value,"/"+5381));var decryptv=CryptoJS.AES.decrypt($('#defaultReal').attr('captchav'),"/"+5381).toString(CryptoJS.enc.Utf8);$('#captcha_val').val(decryptv);for(var i=0;i<value.length;i++){hash=((hash<<5)+hash)+value.charCodeAt(i)}
return hash}})(jQuery)
